import tkinter as tk
import random
import time

class BoxingTimer:
    def __init__(self, root):
        self.root = root
        self.root.title("Boxing Training Timer")
        
        # Configuration
        self.total_rounds = 12
        self.round_duration = 180  # 3 minutes
        self.rest_duration = 60    # 1 minute
        self.surprise_duration = 30
        
        # Determine Hook Rounds (e.g., rounds 4, 8, 12)
        self.hook_rounds = [4, 8, 12]
        
        # Determine Surprise Round (Randomly between 5-11, avoiding hook rounds)
        self.surprise_round_trigger = random.randint(5, 11)
        while self.surprise_round_trigger in self.hook_rounds:
            self.surprise_round_trigger += 1
            if self.surprise_round_trigger > 11:
                self.surprise_round_trigger = 5
        
        self.current_round = 1
        self.is_rest = False
        self.is_surprise = False
        self.time_left = self.round_duration
        
        # UI Setup
        self.label_status = tk.Label(root, text="Round 1", font=("Helvetica", 48), bg="green", fg="white")
        self.label_status.pack(expand=True, fill="both")
        
        self.label_timer = tk.Label(root, text=self.format_time(self.time_left), font=("Helvetica", 72), bg="green", fg="white")
        self.label_timer.pack(expand=True, fill="both")
        
        self.label_instruction = tk.Label(root, text="Work!", font=("Helvetica", 32), bg="green", fg="white")
        self.label_instruction.pack(expand=True, fill="both")
        
        self.update_timer()

    def format_time(self, seconds):
        mins, secs = divmod(seconds, 100) # Simple display logic for this example
        return f"{seconds // 60:02d}:{seconds % 60:02d}"

    def update_timer(self):
        if self.time_left > 0:
            self.time_left -= 1
            self.label_timer.config(text=self.format_time(self.time_left))
            self.root.after(1000, self.update_timer)
        else:
            self.next_phase()

    def next_phase(self):
        if self.is_surprise:
            # Finished surprise, go to rest
            self.is_surprise = False
            self.is_rest = True
            self.time_left = self.rest_duration
            self.setup_ui("Rest", "yellow", "black", "Recover")
        elif self.is_rest:
            # Finished rest, go to next round
            self.is_rest = False
            self.current_round += 1
            if self.current_round > self.total_rounds:
                self.label_status.config(text="Finished", bg="blue")
                return
            self.time_left = self.round_duration
            self.setup_ui(f"Round {self.current_round}", "green", "white", self.get_round_type())
        else:
            # Finished a round, check if surprise should trigger
            if self.current_round == self.surprise_round_trigger:
                # Need rest first, then surprise
                self.is_rest = True
                self.time_left = self.rest_duration
                self.setup_ui("Rest", "yellow", "black", "Prepare for Surprise!")
                # Mark that the NEXT phase after this rest is the surprise
                self.is_rest = False 
                self.trigger_surprise_after_rest()
            else:
                # Normal rest
                self.is_rest = True
                self.time_left = self.rest_duration
                self.setup_ui("Rest", "yellow", "black", "Recover")

        self.update_timer()

    def trigger_surprise_after_rest(self):
        # Helper to ensure surprise follows the rest of the trigger round
        def start_surprise():
            self.is_surprise = True
            self.time_left = self.surprise_duration
            content = random.choice(["30s Non-stop Straights!", "30s Non-stop Hooks!"])
            self.setup_ui("SURPRISE ROUND", "white", "black", content)
            self.update_timer()
        
        # Override the next_phase temporarily for the specific transition
        self.next_phase = start_surprise

    def get_round_type(self):
        if self.current_round in self.hook_rounds:
            return "Hook Focused Round!"
        return "Work!"

    def setup_ui(self, status, bg, fg, instruction):
        self.label_status.config(text=status, bg=bg, fg=fg)
        self.label_timer.config(bg=bg, fg=fg)
        self.label_instruction.config(text=instruction, bg=bg, fg=fg)
        self.root.config(bg=bg)

if __name__ == "__main__":
    root = tk.Tk()
    root.geometry("600x400")
    app = BoxingTimer(root)
    root.mainloop()
